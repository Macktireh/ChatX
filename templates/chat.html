{% extends "base.html" %} {% block title %}Chat - {{ username }}{% endblock %}
{% block content %}
<div class="min-h-screen flex flex-col">
  <!-- Header -->
  <div class="navbar bg-base-100 shadow-lg">
    <div class="flex-1">
      <a class="btn btn-ghost normal-case text-xl">ðŸ’¬ Chat en Temps RÃ©el</a>
    </div>
    <div class="flex-none gap-2">
      <div class="flex items-center gap-2">
        <img src="{{ avatar }}" alt="" class="size-8" />
        <span class="font-semibold">{{ username }}</span>
      </div>
      <a href="/" class="btn btn-ghost btn-sm">Quitter</a>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="flex-1 container mx-auto p-4 max-w-4xl">
    <div class="card bg-base-100 shadow-xl h-full flex flex-col">
      <!-- Messages Area -->
      <div
        id="messages-container"
        class="flex-1 p-4 overflow-y-auto space-y-4"
        style="max-height: calc(100vh - 250px)"
      >
        {% for msg in messages %}
        <div
          class="chat {% if msg.username == username %}chat-end{% else %}chat-start{% endif %}"
        >
          <div class="chat-image">
            <img src="{{ msg.avatar }}" alt="" class="size-10 rounded-full" />
          </div>
          <div class="chat-header">
            {{ msg.username }} {% if msg.is_bot %}
            <span class="badge badge-primary badge-sm ml-1">Bot</span>
            {% endif %}
            <time class="text-xs opacity-50 ml-1"
              >{{ msg.timestamp.strftime('%H:%M') }}</time
            >
          </div>
          <div
            class="chat-bubble {% if msg.is_bot %}chat-bubble-accent opacity-70{% elif msg.username == username %}{% endif %}"
          >
            {{ msg.message }}
          </div>
        </div>
        {% endfor %}
      </div>

      <!-- Input Area -->
      <div class="p-4 border-t border-base-300">
        <form id="message-form" class="flex gap-2">
          <input
            type="text"
            id="message-input"
            placeholder="Tapez votre message... (utilisez @bot pour parler au bot)"
            class="input input-bordered flex-1"
            autocomplete="off"
          />
          <button type="submit" class="btn btn-primary">Envoyer</button>
        </form>
        <div class="text-xs text-base-content/50 mt-2">
          ðŸ’¡ Astuce : Mentionnez @bot dans votre message pour obtenir une
          rÃ©ponse automatique
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container" class="toast toast-top toast-end"></div>
{% endblock %} {% block scripts %}
<script>
  const username = "{{ username }}";
  const avatar = "{{ avatar }}";
</script>
<script src="/static/js/chat.js"></script>
{% endblock %}
